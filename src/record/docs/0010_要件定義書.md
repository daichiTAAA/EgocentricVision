# 要件定義書  
## 1. 概要  
本システムは、RTSPおよびWebRTCプロトコルによる動画ストリームをRustで取得し、リアルタイム再生、録画（保存）、保存済み動画の再生、ストリーム接続設定を提供するバックエンドサービスを実装する。

## 2. 機能要件  
### 2.1 RTSP/WebRTCストリーム取得  
- 指定されたRTSPまたはWebRTCエンドポイントに接続し、動画ストリームを受信する。  
- ストリームの接続・切断をAPI経由で制御可能とする。

### 2.2 リアルタイム再生  
- 受信中のストリームをWebクライアント等にリアルタイムで配信するAPIを提供する。  
- WebSocketやHTTPベースのストリーミング（例：HLS, MPEG-DASH）に対応する。

### 2.3 録画（保存）  
- 受信したストリームを指定フォーマット（例：mp4, mkv等）でサーバ上に保存する。  
- 録画の開始・停止をAPI経由で制御可能とする。  
- 保存先ディレクトリやファイル名の指定が可能。

### 2.4 保存済み動画の再生  
- 保存済み動画ファイルをWebクライアント等に配信するAPIを提供する。  
- 再生位置の指定（シーク）や一時停止・再開に対応する。

### 2.5 接続設定管理  
- RTSP/WebRTCの接続先URL、認証情報、各種パラメータをAPI経由で設定・取得・更新できる。  
- 設定情報は永続化され、再起動後も保持される。

## 3. 非機能要件  
- Rust言語で実装し、パフォーマンス・安定性・安全性を重視する。  
- APIはRESTfulまたはgRPCで提供する。  
- ログ出力、エラーハンドリング、監視用エンドポイントを実装する。  
- Docker等によるコンテナ化対応。

## 4. 想定利用ライブラリ・技術  
- RTSP: gstreamer-rs, ffmpeg-rs など  
- WebRTC: webrtc-rs など  
- Webサーバ: actix-web, axum, warp など  
- ストレージ: ローカルファイルシステム、必要に応じてクラウドストレージ  
- 設定管理: SQLite, TOML/YAML/JSONファイル等

## 5. セキュリティ要件  
- API認証（トークン認証等）  
- ストリーム・保存データのアクセス制御  
- 入出力データのバリデーション

## 6. 拡張性・保守性  
- 新たなストリームプロトコル追加や、保存フォーマット追加が容易な設計  
- モジュール化された構成
